<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: react/components/promo/desktop/PromoCheckoutPaymentForm.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: react/components/promo/desktop/PromoCheckoutPaymentForm.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from 'react';
import { connect } from 'react-redux';
import { reduxForm, Field, formValueSelector } from 'redux-form';
import creditCartType from 'credit-card-type';
import {
  TextField,
  CVVField,
  // SameAddressCheckField, TODO: Some time later this might be used
  Spinner,
  SuccessModal,
  Modal,
  CardExpiryField,
} from 'react/components/common';
import {
  billingFormValidator,
  normalizeCardNumber,
  normalizeSecurityCode,
} from 'helpers';

/**
 * @class PromoCheckoutPaymentFormClass
 * @extends {React.Component}
 */
class PromoCheckoutPaymentFormClass extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      active_cc_type: '',
      show_cvv_modal: false,
      showErrorModal: false,
    };
    this._toggleCVVModal = this._toggleCVVModal.bind(this);
  }

  componentWillReceiveProps(newProps) {
    if (
      this.props.submitStatus === 'submitting' &amp;&amp;
      newProps.submitStatus === 'failure'
    ) {
      this.setState({ showErrorModal: true });
    }
  }

  _toggleCVVModal(e) {
    e.preventDefault();
    this.setState({ show_cvv_modal: !this.state.show_cvv_modal });
  }

  /**
   * @param {*} cc credit card number
   * @memberof PromoCheckoutPaymentFormClass
   * @description check creditcard type using package "credit-card-type"
   */
  _checkCardType(cc) {
    if (!cc) return;

    const value = cc.toString().replace(/\s/g, '');
    const cc_type = creditCartType(value);

    if (cc_type &amp;&amp; cc_type[0] &amp;&amp; value.length > 3) {
      this.setState({ active_cc_type: cc_type[0].type });
    } else if (this.state.active_cc_type || value.length &lt; 3) {
      this.setState({ active_cc_type: '' });
    }
  }

  render() {
    const { active_cc_type, show_cvv_modal } = this.state;

    return (
      &lt;div className="chkfrm-mid">
        {show_cvv_modal &amp;&amp; (
          &lt;Modal onClose={this._toggleCVVModal}>
            CVV/CID
            &lt;center>
              &lt;img src="/static/promo/common/cvv.jpg" alt="" />
            &lt;/center>
          &lt;/Modal>
        )}
        &lt;form
          onSubmit={this.props.handleSubmit}
          className="pure-form pure-form-aligned fv-form fv-form-pure"
        >
          &lt;button
            type="submit"
            className="fv-hidden-submit"
            style={{ display: 'none', height: 0, width: 0 }}
          />
          &lt;div className="cards">
            &lt;span
              className={`card-visa ${
                active_cc_type === 'visa' ? 'active' : ''
              }`}
            >
              &lt;img src="/static/Visa.png" alt="" />
            &lt;/span>
            &lt;span
              className={`card-mastercard ${
                active_cc_type === 'master-card' ? 'active' : ''
              }`}
            >
              &lt;img src="/static/Mastercard.png" alt="" />
            &lt;/span>
            &lt;span
              className={`card-discover" ${
                active_cc_type === 'american-express' ? 'active' : ''
              }`}
            >
              &lt;img src="/static/amex.png" alt="" />
            &lt;/span>
          &lt;/div>
          {/*
            TODO: Some time later this might be used if we have a user requirement to input
              different addresses for billing and shipping.
              For now it is not used.
            &lt;Field component={SameAddressCheckField} name="same" />
          */}
          &lt;div className="clearfix" />
          &lt;div id="billingDiv" style={{ display: 'none' }} />
          &lt;Field
            component={TextField}
            name="cardNumber"
            className="creditcard"
            placeholder="•••• •••• •••• ••••"
            label="Card No*"
            onChange={e => this._checkCardType(e.target.value)}
            normalize={normalizeCardNumber}
          />
          &lt;Field component={CardExpiryField} name="cardExpiry" />
          &lt;Field
            containerClass="frm-elem-cvv"
            component={CVVField}
            label="CVV/CID*"
            name="cardSecurityCode"
            className="short"
            normalize={normalizeSecurityCode}
            cvvClick={this._toggleCVVModal}
          />
          &lt;div className="clearall" />
          &lt;button onClick={this.submitForm} className="chk-submit pulse" />
        &lt;/form>
        {this.props.submitStatus === 'submitting' &amp;&amp; &lt;Spinner />}
        &lt;SuccessModal
          visible={this.props.submitStatus === 'success'}
          message="Your order has been placed successfully."
        />
        &lt;SuccessModal
          style={{ width: 423 }}
          title="Problem with your order"
          visible={this.state.showErrorModal}
          onClose={() => this.setState({ showErrorModal: false })}
          message={this.props.submitFailure}
        />
      &lt;/div>
    );
  }
}

const PromoCheckoutPaymentFormComponent = reduxForm({
  form: 'BillingForm',
  validate: billingFormValidator,
})(PromoCheckoutPaymentFormClass);

const selector = formValueSelector('BillingForm');

function mapStateToProps(reduxState) {
  if (reduxState.order) {
    return {
      initialValues: {
        same: 'Yes',
      },
      currentValues: {
        same: selector(reduxState, 'same'),
      },
      submitStatus: reduxState.order.placeOrderStatus,
      submitFailure: reduxState.order.placeOrderError,
    };
  }
  return {};
}

const PromoCheckoutPaymentForm = connect(mapStateToProps)(
  PromoCheckoutPaymentFormComponent,
);

export { PromoCheckoutPaymentForm };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AddressField.html">AddressField</a></li><li><a href="CardExpiryField.html">CardExpiryField</a></li><li><a href="Cart.html">Cart</a></li><li><a href="CartContainer.html">CartContainer</a></li><li><a href="CartForm.html">CartForm</a></li><li><a href="ChooseProductsForm.html">ChooseProductsForm</a></li><li><a href="ContactUs.html">ContactUs</a></li><li><a href="Footer.html">Footer</a></li><li><a href="Header.html">Header</a></li><li><a href="MobileCardExpiryField.html">MobileCardExpiryField</a></li><li><a href="MobileConfirmContainerComponent.html">MobileConfirmContainerComponent</a></li><li><a href="MobileSelectPackageContainer.html">MobileSelectPackageContainer</a></li><li><a href="MobileShippingContainerComponent.html">MobileShippingContainerComponent</a></li><li><a href="Modal.html">Modal</a></li><li><a href="PromoCheckoutPaymentFormClass.html">PromoCheckoutPaymentFormClass</a></li><li><a href="PromoDesktop.html">PromoDesktop</a></li><li><a href="PromoMobileContainer.html">PromoMobileContainer</a></li><li><a href="ThankyouDesktopComponent.html">ThankyouDesktopComponent</a></li><li><a href="ThankyouMobileComponent.html">ThankyouMobileComponent</a></li><li><a href="Upsell1Component.html">Upsell1Component</a></li><li><a href="Upsell2.html">Upsell2</a></li><li><a href="Upsell11Component.html">Upsell11Component</a></li><li><a href="Upsell21.html">Upsell21</a></li><li><a href="UpsellDesktopContainerComponent.html">UpsellDesktopContainerComponent</a></li><li><a href="UpsellMobileContainerComponent.html">UpsellMobileContainerComponent</a></li></ul><h3>Namespaces</h3><ul><li><a href="api-helpers.html">api-helpers</a></li><li><a href="helpers.html">helpers</a></li><li><a href="orderSaga.html">orderSaga</a></li><li><a href="server-middleware.html">server-middleware</a></li><li><a href="sessionSaga.html">sessionSaga</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getSessionId">getSessionId</a></li><li><a href="global.html#Link">Link</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Jun 18 2018 14:26:35 GMT+0530 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
